# 元件原則
###### tags: `Book` `sofaware`
## 元件
- 元件是部署的單位
- 它們是系統部署時最小的部分實體
    - JAVA 是 Jar 檔
    - Ruby 是 gem 檔
    - .NET 是 DLL 檔
- 一個良好的元件會始終保持著可獨立部署能力，也應此能獨立開發
## 元件內聚性

### REP 在使用性 - 發佈等價原則
不應包括與包的目的無關的類。構建為可重用類別系列的 package 往往是最有用和可重用的。

一個元件的**類別**和**模組**必須是一個具以內聚力的群組。模組必須有一些總體組題或目的。

組合到一個元件中的類別和模組應該被一起**發佈**。實際上它們共享相同的版本號和版本追蹤，並被包含在同一版本文件中，對於作者和使用者是有幫助的。元件作者的責任：

- 維護程式碼
- 功能更新通知
- 發佈文件能夠讓使用者是否要整合新版本，以保證元件可以向下兼容

現在模組管理工具都可以做到（Maven、Leiningen 和 RVM）

此原則弱點需要靠 CCP、CRP 來強列定義。

:::success
在使用性的細微度就是發佈的細微度
:::
#### Ref 
[REP](https://www.youtube.com/watch?v=YtL3UE_GF3E)
[wiki](https://en.wikipedia.org/wiki/Package_principles#Principles_of_package_cohesion)

### CCP 共同封閉原則

這個方案**不應該有多個改變的理由**。如果在依賴於許多軟件包的應用程序中發生了更改，理想情況下，只需要**在一個軟件包中進行更改**，而不是在一些軟件包中進行更改。這有助於識別可能發生變化的類，並將它們打包在一起，原因相同。**如果類緊密耦合，則它們屬於同一個包**。

大多數的應用程式中，**可維護性的重要大於可重用性的**。當一個應用程式的程式碼需要更改，寧願將**更改的都集中在一個元件當中**，因為只需重新佈署此元件。

CCP 說**基於相同原因而改變的所有類別公同聚集在同一個地方**。如果兩個類別高度的耦合，那麼它們應該要是**一起變化**，因為它們隸屬**同一元件中**。這樣可以減少軟體的發佈、重新驗證、重新佈署的工作量。

此原則與 OCP 開放-封閉原則密切相關。OCP 定義了類別對於修改是封閉的，對於擴展是開放的。要 100% 封閉是不可能的。**設計的系統應當對於我們經歷過的、最常見的變化做到封閉**(抽象或介面化)。

CCP **對於一些確定的變化類型開放的類別**共同組織到同一個元件當中。因此，需求一有變化，此變化會被限制在最小數量的元件中。

:::success
將那些會因為**相同理由**、在**相同時間發生變化**的類別收集到相同的元件之中。
將那些在不同時間、因為不同的理由發生變化的類別分割到不同的元件之中。
:::

#### 與 SRP
這是 SRP 對於元件的重新規定
- SRP 
    - 對於一個**類別**不應該包含多個引起變化的原因
    - **方法**會因不同原因而改變，將這些方法劃分至不同**類別**
- CCP 
    - 對於一個**元件**不應該包含多個引起變化的原因
    - **類別**會因不同原因而改變，把這些類別劃分到不同的**元件**
:::info
把那些同一時間和相同的原因改變的東西聚集起來。
把那些在不同時間或不同的原因改變的東西分離開來。
:::

### CRP 共同重複使用原則

CRP 是幫助我們決定要將那些**類別**和**模組**放入元件的另一個原則。要把傾向於一起**重用的類別和模組**放入同一個元件中。

可重用的類別與可重用抽象的其他類別是一起工作的。CRP 指出這些別應該屬於同一元件。反而會希望看到彼此具有很多依賴關係的類別。

**CRP 還告訴我們哪些類別不要放在同一元件中**。

當我們依賴一個元件時，要確保我們依賴於該元件中的每個類別。也就是**確保我們放入元件中的類別是不可分割的**。

因此，**不緊密相連的類別不應該放在同一個元件中**。

:::info
不要強迫元件的使用者依賴他們需要的東西。
:::

#### 和 ISP 關係
- ISP
    - 建議我們不要依賴於包含我們未使用的**方法的類別**。
- CRP
    - 建議我們不要依賴於包含我們未使用的**類別的元件**。

### 元件內聚性

![](https://i.imgur.com/jJljgzk.png)

在這張力圖可以知道三種原則是互相拉鋸的。

REP 和 CCP 是**包容性**原則，**傾向於使元件變得更大**。
CRP 則是**排除性**原則，**使元件變小**。

一般來說，專案往往從三角形右側開始。


### 總結
在選擇類別組合成元件時，必須考慮涉及到**可重複性**、**可發展性**的相對力量。所以會根據需求而動態改變這些拉鋸力走向，將發展性轉為可重用性。


## Ref
[fagnerbrack - package](https://medium.com/@fagnerbrack/why-do-you-need-to-know-package-cohesion-fundamentals-8a3510cba2c1)


