# Buffer Overflow
當程式將數據寫入緩衝區時，會發生緩衝區溢出，從而超出該緩衝區的容量。這就像將 12 盎司的牛奶倒入 8 盎司的玻璃杯中。

## What is buffer overflow ?
Buffer overflow 是一種異常現象，當軟體將數據寫入緩衝區溢出緩衝區的容量時會發生異常，導致相鄰的儲存單元被覆蓋。換句話說，太多的訊息被傳遞到沒有足夠空間的容器中，並且該訊息最終會替換相鄰容器中的數據。

攻擊者可利用緩衝區溢出，目的是修改計算機的 `memory`，以破壞或控製程序執行。

![](https://www.cloudflare.com/img/learning/security/threats/buffer-overflow/buffer-overflow-example.svg)

## What’s a buffer ?
緩衝區或數據緩衝區是物理內存存儲區域，用於在數據從一個位置移動到另一個位置時臨時儲存數據，這些緩衝區通常存在於 RAM 儲存器中。計算機經常使用緩衝區來幫助提高性能，大多數現代 Disk 利用緩衝來有效的訪問數據，許多在線服務也使用緩衝區，例如：緩衝區經常用於在線視頻流中以防止中斷，當視頻串流傳輸時，視頻播放器一次下載並將大約 20% 的視頻存儲在緩衝區中，然後從該緩衝區串流傳輸。這樣，連接速度的輕微下降或快速服務中斷不會影響視頻串流性能。

緩衝區指在包含特定數量的數據。除非使用緩衝區的程序具有內置指令以在向緩衝區發送太多數據時丟棄數據，否則程序將覆蓋緩衝區附近的 memory 中的數據。

攻擊者可以利用緩衝區溢出來破壞軟件。儘管眾所周知，緩衝區溢出攻擊仍然是一個折磨網路安全團隊的主要安全問題。2014 年，由於 SSL 軟體中存在緩衝區溢出漏洞，稱為 "heartbleed" 的威脅使數億用戶受到攻擊。

## How do attackers exploit buffer overflows ?
攻擊者可以故意將精心設計的輸入提供給程序，該程序將導致程序嘗試將該輸入儲存在不夠大的緩衝區中，從而覆蓋連接到緩衝區空間的部分 memory。如果程序的 memory 佈局定義明確，攻擊者可以故意覆蓋已知包含可執行代碼的區域，然後，攻擊者可以使用自己的可執行代碼替換此代碼，這可能會徹底改變程序的工作方式。

例如，如果 memory 中的覆蓋部分包含指標（指向 memory 中另一個位置的對象），則攻擊者的代碼可以用指向漏洞利用有效負載的另一個指標替換該代碼。這可以將整個程序的控制權轉移給攻擊者的代碼。

## Who is vulnerable to buffer overflow attacks ?
某些編程語言比其他語言更容易受緩衝區溢出的影響。C 和 C++ 是兩種具有高漏洞的流行語言，因為它們不包含對 memory 中訪問或覆蓋數據的內置保護。Windows、Mac OSX 和 Linux 都包含用這些語言中的一種或兩種語言編寫的代碼。

Java、PERL 和 C# 等更現代的語言具有內置功能，有助於減少緩衝區溢出的可能性，但無法完全阻止它。

## How to protect against buffer overflow attacks
幸運的是，現代作業系統具有運行時保護功能，可幫助緩解緩衝區溢出攻擊。
探索兩種有助於降低利用風險的常見保護措施：

- Address space randomization
    - 隨機重新排列行程關鍵數據區域的位址空間位置。緩衝區溢出攻擊通常依賴於知道重要可執行代碼的確切位置，位址空間的隨機化使得這幾乎不可能。
- Data execution prevention
    - 將某些 memory 區域標記為可執行或不可執行，從而防止利用漏洞運行在非可執行區域中找到的代碼。

軟體開發人員還可以透過編寫具有內置保護語言或在代碼中使用特殊安全過程的語言來預防緩衝區溢出漏洞。

儘管採取了預防措施，開發人員仍然會發現新的緩衝區溢出漏洞，有時是在成功利用之後，發現新漏洞時，工程師需要修補受影響的軟體，並確保軟體用戶可以訪問該補丁。

## What are the different types of buffer overflow attacks ?
有許多不同的緩衝區溢出攻擊採用不同的策略並針對不同的代碼片段。以下是一些最知名的。

- Stack overflow attack
    - 這是最常見的緩衝區溢出攻擊類型，並且涉及在調用 stack* 上溢出緩衝區。
- Heap overflow attack
    - 此類攻擊的目標是打開 memory pool 的數據，稱為 heap*。
- Integer overflow attack
    - 在整數溢出中，算術運算導致整數（整數）對於用於儲存它的整數類型而言太大，這可能導致緩衝區溢出。
- Unicode overflow
    - Unicode 溢出透過將 unicode 字符插入到期望 ASCII 字符的輸入中來創建緩衝區溢出。（ASCII 和 unicode 是允許計算機表示文本的編碼標準。例如，字母 'a' 由 ASCII 中的數字 97 表示。雖然 ASCII 碼僅涵蓋西方語言中的字符，但 unicode 可以為地球上的幾乎所有書面語言創建字符。因為 unicode 中有更多字符可用，所以許多 unicode 字符大於最大的ASCII字符。）

計算機依賴於兩種不同的 memory 分配模型，稱為 stack 和 heap。兩者都住在電腦的 RAM 中。
##### Stack
Stack 整齊有序，並以 Last-In、First-Out 模型保存數據。無論最近放置在 stack 中的數據是第一個出來的，有點像插入彈藥雜誌的最後一顆子彈將是第一個被解僱的。
##### Heap
Heap 是一個無組織的額外 memory pool，數據不會以任何特定順序進入或離開 heap。


由於從 stack 訪問 mempry 比從 heap 中訪問內存要快得多，因此 heap 通常保留用於程序員想要明確管理的較大數據或數據。